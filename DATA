import pandas as pd
import numpy as np
from sklearn.model_selection import train_test_split
from sklearn.preprocessing import StandardScaler, LabelEncoder
from sklearn.ensemble import RandomForestClassifier, RandomForestRegressor
from sklearn.linear_model import LinearRegression, LogisticRegression
from sklearn.tree import DecisionTreeClassifier, DecisionTreeRegressor
from sklearn.metrics import classification_report, mean_squared_error, r2_score, accuracy_score
import matplotlib.pyplot as plt
import seaborn as sns
import os
import requests
from io import StringIO

def load_india_data():
    '''Enhanced function to load Indian Agriculture dataset from Kaggle'''
    print('=== LOADING INDIAN AGRICULTURE DATASET ===')
    
    # First try to load from local files (if already downloaded)
    local_paths = [
        'indian_agriculture_dataset.csv',
        'agriculture_dataset.csv', 
        'DATA/indian_agriculture_dataset.csv',
        'data/agriculture_dataset.csv',
        'Agriculture_dataset.csv'
    ]
    
    print('üìÅ Checking for local dataset files...')
    for path in local_paths:
        if os.path.exists(path):
            try:
                df = pd.read_csv(path)
                print(f'‚úÖ Loaded local file from {path}: {df.shape}')
                return df
            except Exception as e:
                print(f'‚ùå Error loading {path}: {str(e)}')
                continue
    
    print('‚ùå Local dataset not found')
    print('\nüìù DATASET INFORMATION:')
    print('- Source: Kaggle - Indian Agriculture Dataset')
    print('- URL: https://www.kaggle.com/datasets/vineetkukreti/indian-agriculture-dataset')
    print('- Content: Agricultural production data across Indian states')
    print('- Features: State, District, Crop, Year, Season, Area, Production')
    
    print('\nüîß TO DOWNLOAD THE DATASET:')
    print('1. Visit: https://www.kaggle.com/datasets/vineetkukreti/indian-agriculture-dataset')
    print('2. Click "Download" to get the CSV file')
    print('3. Place the downloaded file in your working directory')
    print('4. Rename it to "indian_agriculture_dataset.csv" (optional)')
    
    # Create a sample dataset based on the actual structure for demonstration
    print('\nüèóÔ∏è Creating sample Indian Agriculture dataset for demonstration...')
    
    sample_data = {
        'State_Name': ['Uttar Pradesh', 'Maharashtra', 'Punjab', 'Haryana', 'West Bengal'] * 4,
        'District_Name': ['Agra', 'Pune', 'Ludhiana', 'Karnal', 'Kolkata'] * 4,
        'Crop_Year': [2018, 2019, 2020, 2021] * 5,
        'Season': ['Kharif', 'Rabi', 'Summer', 'Kharif', 'Rabi'] * 4,
        'Crop': ['Rice', 'Wheat', 'Sugarcane', 'Cotton', 'Maize'] * 4,
        'Area': np.random.uniform(1000, 50000, 20),  # Area in hectares
        'Production': np.random.uniform(5000, 200000, 20)  # Production in tonnes
    }
    
    df = pd.DataFrame(sample_data)
    print(f'‚úÖ Sample dataset created: {df.shape}')
    print('Note: This is sample data. Please download the actual Kaggle dataset for real analysis.')
    
    return df

def explore_india_data():
    '''Explore and analyze the Indian Agriculture dataset'''
    
    # Load data
    df = load_india_data()
    
    if df is None:
        print('Cannot proceed without data files')
        return
    
    print('\n=== INITIAL DATA EXPLORATION ===')
    print(f'Dataset shape: {df.shape}')
    print('Columns:', df.columns.tolist())
    print('\nFirst few rows:')
    print(df.head())
    
    print('\nData types:')
    print(df.dtypes)
    
    print('\nMissing values:')
    print(df.isnull().sum())
    
    print('\nBasic statistics:')
    print(df.describe())
    
    return df

if __name__ == '__main__':
    explore_india_data()
